{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/macbook/Desktop/Desktop%20Files/y2.5%20-%20ReDefination/PROJECT%20DIR.%201/catalyst-design-system/examples/next-app/src/proxy.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\n\n// Proxy runs before routes. We use it to:\n// - Advertise and consume Sec-CH-Prefers-Color-Scheme client hint\n// - Set a stable `theme` cookie ('dark' | 'light') to align SSR/CSR\n// - In system palette mode, set `palette` from mapped light/dark cookies\n// - Preserve existing route guard for /settings\n\nexport function proxy(req: NextRequest) {\n  const url = req.nextUrl;\n\n  // Base response\n  const res = NextResponse.next();\n\n  // Advertise support for color scheme client hint and make it critical\n  res.headers.set(\"Accept-CH\", \"Sec-CH-Prefers-Color-Scheme\");\n  res.headers.set(\"Vary\", \"Sec-CH-Prefers-Color-Scheme\");\n  res.headers.set(\"Critical-CH\", \"Sec-CH-Prefers-Color-Scheme\");\n\n  // Read client hint (may be quoted)\n  const ch = req.headers.get(\"Sec-CH-Prefers-Color-Scheme\") || \"\";\n  const pref = ch.replace(/\"/g, \"\").toLowerCase(); // \"dark\" | \"light\" | \"\"\n\n  const existingTheme = req.cookies.get(\"theme\")?.value;\n  const paletteMode = req.cookies.get(\"palette-mode\")?.value || \"custom\";\n  const systemLight = req.cookies.get(\"palette-system-light\")?.value || \"blue\";\n  const systemDark = req.cookies.get(\"palette-system-dark\")?.value || \"indigo\";\n\n  let themeToSet: \"dark\" | \"light\" | undefined;\n  if (pref === \"dark\" || pref === \"light\") {\n    themeToSet = pref as \"dark\" | \"light\";\n  }\n\n  // Write theme cookie if we have a preference and it's different\n  if (themeToSet && themeToSet !== existingTheme) {\n    res.cookies.set(\"theme\", themeToSet, {\n      path: \"/\",\n      maxAge: 60 * 60 * 24 * 365,\n    });\n  }\n\n  // If palette mode is system, set palette cookie based on mapped values\n  if (paletteMode === \"system\" && themeToSet) {\n    const nextPalette = themeToSet === \"dark\" ? systemDark : systemLight;\n    res.cookies.set(\"palette\", nextPalette, {\n      path: \"/\",\n      maxAge: 60 * 60 * 24 * 365,\n    });\n  }\n\n  // Route guard for /settings (migrated from deprecated middleware)\n  if (url.pathname.startsWith(\"/settings\")) {\n    const canAccess = req.cookies.get(\"canAccessSettings\")?.value === \"true\";\n    if (!canAccess) {\n      const redirectUrl = url.clone();\n      redirectUrl.pathname = \"/\";\n      redirectUrl.searchParams.set(\"settings\", \"denied\");\n      return NextResponse.redirect(redirectUrl);\n    }\n  }\n\n  return res;\n}\n\nexport const config = {\n  // Run for all paths to ensure Accept-CH is advertised; guard logic checks /settings\n  matcher: [\"/(.*)\"],\n};"],"names":[],"mappings":";;;;;;AAAA;;AAQO,SAAS,MAAM,GAAgB;IACpC,MAAM,MAAM,IAAI,OAAO;IAEvB,gBAAgB;IAChB,MAAM,MAAM,yKAAY,CAAC,IAAI;IAE7B,sEAAsE;IACtE,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa;IAC7B,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ;IACxB,IAAI,OAAO,CAAC,GAAG,CAAC,eAAe;IAE/B,mCAAmC;IACnC,MAAM,KAAK,IAAI,OAAO,CAAC,GAAG,CAAC,kCAAkC;IAC7D,MAAM,OAAO,GAAG,OAAO,CAAC,MAAM,IAAI,WAAW,IAAI,wBAAwB;IAEzE,MAAM,gBAAgB,IAAI,OAAO,CAAC,GAAG,CAAC,UAAU;IAChD,MAAM,cAAc,IAAI,OAAO,CAAC,GAAG,CAAC,iBAAiB,SAAS;IAC9D,MAAM,cAAc,IAAI,OAAO,CAAC,GAAG,CAAC,yBAAyB,SAAS;IACtE,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC,wBAAwB,SAAS;IAEpE,IAAI;IACJ,IAAI,SAAS,UAAU,SAAS,SAAS;QACvC,aAAa;IACf;IAEA,gEAAgE;IAChE,IAAI,cAAc,eAAe,eAAe;QAC9C,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,YAAY;YACnC,MAAM;YACN,QAAQ,KAAK,KAAK,KAAK;QACzB;IACF;IAEA,uEAAuE;IACvE,IAAI,gBAAgB,YAAY,YAAY;QAC1C,MAAM,cAAc,eAAe,SAAS,aAAa;QACzD,IAAI,OAAO,CAAC,GAAG,CAAC,WAAW,aAAa;YACtC,MAAM;YACN,QAAQ,KAAK,KAAK,KAAK;QACzB;IACF;IAEA,kEAAkE;IAClE,IAAI,IAAI,QAAQ,CAAC,UAAU,CAAC,cAAc;QACxC,MAAM,YAAY,IAAI,OAAO,CAAC,GAAG,CAAC,sBAAsB,UAAU;QAClE,IAAI,CAAC,WAAW;YACd,MAAM,cAAc,IAAI,KAAK;YAC7B,YAAY,QAAQ,GAAG;YACvB,YAAY,YAAY,CAAC,GAAG,CAAC,YAAY;YACzC,OAAO,yKAAY,CAAC,QAAQ,CAAC;QAC/B;IACF;IAEA,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,oFAAoF;IACpF,SAAS;QAAC;KAAQ;AACpB","debugId":null}}]
}